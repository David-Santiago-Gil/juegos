<header class="header">
  <div class="container-fluid">
    <div class="header-content">

      <!-- Logo -->
      <div class="logo-container">
        <a routerLink="/inicio" class="logo-link" aria-label="Ir al inicio">
          <img src="img/logo.png" alt="Logo" class="logo-image" />
        </a>
      </div>

      <!-- Menú Hamburguesa (solo móvil) -->
      <button
        class="hamburger-menu"
        [class.active]="isMenuOpen"
        (click)="toggleMenu()"
        aria-label="Toggle menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <!-- Navegación Desktop -->
      <nav class="nav-desktop" [class.open]="isMenuOpen">
        <ul class="nav-list">
          <li class="nav-item" *ngFor="let link of navLinks">
            <a
              [routerLink]="link.route"
              routerLinkActive="active"
              class="nav-link"
              (click)="closeMenu()">
              {{ link.label }}
            </a>
          </li>
        </ul>
      </nav>

      <!-- Contenedor Búsqueda + Usuario -->
      <div class="search-user-container">
        <div class="search-container">
          <i class="bi bi-search search-icon" (click)="onSearchSubmit()"></i>
          <input
            type="text"
            class="search-input"
            placeholder="Buscar"
            [value]="searchQuery"
            (input)="onSearchInput($event)"
            (keyup.enter)="onSearchSubmit()">
        </div>
        <div class="user-container">
          <!-- Estado no autenticado: botón Acceder -->
          <ng-container *ngIf="!isAuthenticated; else profileBlock">
            <button class="access-button" (click)="openAuth()">Acceder</button>
          </ng-container>
          <!-- Estado autenticado: avatar con menú perfil -->
          <ng-template #profileBlock>
            <div class="avatar-wrapper" (click)="toggleProfileMenu()" tabindex="0" role="button" aria-haspopup="menu">
              <div class="avatar-circle" *ngIf="!currentAvatar">{{ initials }}</div>
              <img *ngIf="currentAvatar" [src]="currentAvatar" alt="Avatar" class="avatar-image" />
            </div>
            <div class="profile-menu" *ngIf="showProfileMenu">
              <div class="profile-header">
                <div class="avatar-small" *ngIf="!currentAvatar">{{ initials }}</div>
                <img *ngIf="currentAvatar" [src]="currentAvatar" alt="Avatar" class="avatar-small-image" />
                <div class="profile-info">
                  <div class="profile-name">{{ username }}</div>
                  <div class="profile-email">{{ currentEmail }}</div>
                </div>
              </div>
              <button class="profile-action" (click)="fileInput.click()">Cambiar foto de perfil</button>
              <input #fileInput type="file" accept="image/*" style="display:none" (change)="onFileSelected($event)" />
              <button class="profile-action" (click)="changeAccount()">Cambiar de cuenta</button>
              <button class="profile-action danger" (click)="logout()">Cerrar sesión</button>
            </div>
          </ng-template>
        </div>
      </div>

    </div>
  </div>

  <!-- Menú Móvil Overlay -->
  <div class="mobile-menu-overlay" [class.show]="isMenuOpen">
    <nav class="nav-mobile">
      <ul class="nav-list-mobile">
        <li class="nav-item-mobile" *ngFor="let link of navLinks">
          <a
            [routerLink]="link.route"
            routerLinkActive="active"
            class="nav-link-mobile"
            (click)="closeMenu()">
            {{ link.label }}
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Modal Auth (Login/Registro) -->
  <div class="login-modal-backdrop" *ngIf="showAuthModal" (click)="closeAuth()"></div>
  <div class="login-modal" *ngIf="showAuthModal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <button class="login-close" (click)="closeAuth()" aria-label="Cerrar">&times;</button>

    <div class="auth-container">
      <div class="auth-tabs-wrapper">
        <button
          class="auth-tab"
          [class.active]="authMode === 'login'"
          (click)="switchAuthMode('login')"
          [attr.aria-selected]="authMode === 'login'">
          <i class="bi bi-box-arrow-in-right"></i>
          <span>Iniciar sesión</span>
        </button>
        <button
          class="auth-tab"
          [class.active]="authMode === 'register'"
          (click)="switchAuthMode('register')"
          [attr.aria-selected]="authMode === 'register'">
          <i class="bi bi-person-plus"></i>
          <span>Registrarse</span>
        </button>
        <div class="auth-tab-indicator"></div>
      </div>

      <div class="auth-content">
        <form class="login-form" *ngIf="authMode === 'login'" (ngSubmit)="login()">
          <h3 id="authTitle" class="auth-title">Bienvenido de vuelta</h3>
          <p class="auth-subtitle">Ingresa con tu cuenta para continuar</p>

          <div class="form-group">
            <label class="login-label">
              <span class="label-text">Correo electrónico</span>
              <div class="input-wrapper">
                <i class="bi bi-envelope"></i>
                <input type="email" [(ngModel)]="loginForm.email" name="loginEmail" required placeholder="tu@correo.com" (ngModelChange)="loginErrors.email=''; loginErrors.general=''" />
              </div>
              <div class="error-text" *ngIf="loginErrors.email">{{ loginErrors.email }}</div>
            </label>
          </div>

          <div class="form-group">
            <label class="login-label">
              <span class="label-text">Contraseña</span>
              <div class="input-wrapper">
                <i class="bi bi-lock"></i>
                <input type="password" [(ngModel)]="loginForm.password" name="loginPassword" required placeholder="••••••••" (ngModelChange)="loginErrors.password=''; loginErrors.general=''" />
              </div>
              <div class="error-text" *ngIf="loginErrors.password">{{ loginErrors.password }}</div>
            </label>
          </div>

          <div class="error-text general-error" *ngIf="loginErrors.general">{{ loginErrors.general }}</div>

          <button type="submit" class="btn-primary btn-full" [disabled]="loginErrors.email || loginErrors.password">
            <span>Entrar a mi cuenta</span>
            <i class="bi bi-arrow-right"></i>
          </button>

          <button type="button" class="btn-secondary btn-full" (click)="closeAuth()">
            Cancelar
          </button>
        </form>

        <form class="login-form" *ngIf="authMode === 'register'" (ngSubmit)="register()">
          <h3 id="authTitle" class="auth-title">Crea tu cuenta</h3>
          <p class="auth-subtitle">Únete a nuestra comunidad de jugadores</p>

          <div class="form-group">
            <label class="login-label">
              <span class="label-text">Nombre completo</span>
              <div class="input-wrapper">
                <i class="bi bi-person"></i>
                <input type="text" [(ngModel)]="registerForm.name" name="registerName" required placeholder="Tu nombre" (ngModelChange)="registerErrors.name=''" />
              </div>
              <div class="error-text" *ngIf="registerErrors.name">{{ registerErrors.name }}</div>
            </label>
          </div>

          <div class="form-group">
            <label class="login-label">
              <span class="label-text">Correo electrónico</span>
              <div class="input-wrapper">
                <i class="bi bi-envelope"></i>
                <input type="email" [(ngModel)]="registerForm.email" name="registerEmail" required placeholder="tu@correo.com" (ngModelChange)="registerErrors.email=''" />
              </div>
              <div class="error-text" *ngIf="registerErrors.email">{{ registerErrors.email }}</div>
            </label>
          </div>

          <div class="form-group">
            <label class="login-label">
              <span class="label-text">Contraseña</span>
              <div class="input-wrapper">
                <i class="bi bi-lock"></i>
                <input type="password" [(ngModel)]="registerForm.password" name="registerPassword" required placeholder="Mín. 6 caracteres" (ngModelChange)="registerErrors.password=''" />
              </div>
              <div class="error-text" *ngIf="registerErrors.password">{{ registerErrors.password }}</div>
            </label>
          </div>

          <button type="submit" class="btn-primary btn-full" [disabled]="registerErrors.name || registerErrors.email || registerErrors.password">
            <span>Crear mi cuenta</span>
            <i class="bi bi-check-circle"></i>
          </button>

          <button type="button" class="btn-secondary btn-full" (click)="closeAuth()">
            Cancelar
          </button>
        </form>
      </div>
    </div>
  </div>
</header>
